> 介绍 https://jwt.io/introduction
> 加解密工具 https://jwt.io/#debugger-io

JWT全程为json web token 是目前最流行的跨域认证解决方案。

# 跨域认证的问题

互联网服务的用户认证流程一般如下

1. 用户向服务器发送用户名和密码
2. 服务器验证过后，在当前对话（session）里面保存相关数据，比如用户角色，登陆时间等
3. 服务器向用户返回一个session_id，写入用户的cookie
4. 用户随后的每一个请求，都会通过cookie，将session_id传回服务器。
5. 服务器收到session_id。找到前期保存的数据，由此得到用户的身份。

现在我们考虑的是如果要求A网站和B网站是同一家公司的关联服务，现在要求，用户只要在其中一个网站登录，再访问另一个网站就会自动登录，请问怎么实现。
JWT就提供了解决方案，服务器不保存用户的session数据，所有数据都在客户端，每次请求都发回服务器。

# 原理

JWT的原理是，服务器认证以后，生成一个JSON对象，发送给用户，就像下面这样：

```json
{
  "sub": "1234567890",
  "name": "John Doe",
  "iat": 1516239022
}
```

以后，用户每次想和服务器通讯，都会发送这个json对象。服务器完全只靠这个对象来认定用户身份。这样服务器就可以不保存session数据，减轻了服务器的载荷同时也易于扩展。

# JWT的数据结构

实际的JWT中间用`.`分割成三个部分。JWT内部是没有换行的，这里是为了好表示，所以写成了几行。
JWT的三个部分有`Header`,`Payload`,`Signature`

## `Header`

`Header`部分就是一个`json`对象，它用来描述`JWT`的元数据，说明使用的签名算法和`token`的类型。

## `Payload`

`payload`也是一个`json`对象，用来存放我们实际需要传送的数据

## `Signature`

最后`Signature`是为了防止对两部分内容进行数据篡改，而采用的安全措施。
服务器会存有一个密钥，然后使用`header`里面指定的签名算法（默认为`SHA256`），按照以下公式来产生签名。

然后把三个部分拼接为字符串，每个部分用点`.`分割，然后传给用户。

# JWT的几个特点

1. JWT默认是不加密的。所以最好不要将秘密数据放在JWT里面。
2. JWT不仅可以用作用户验证，也可以用于交换信息，有效使用JWT，可以降低服务器查询数据库的次数。
3. JWT的最大缺点为，因为服务器不保存session状态，所以再服务器签发了某个JWT后，并不能废除或者更改某个TOKEN。
4. JWT本身包含了认证信息，一旦泄露的话，任何人都可以获得该令牌的所有权限，为了减少盗用，JWT的有效期应该设置为比较短。
5. 传输JWT的时候，应该用`HTTPS`协议传输。
